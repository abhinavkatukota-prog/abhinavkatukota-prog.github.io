<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Beatable Pixel Platformer</title>
  <style>
    body {
      margin: 0;
      background: #1e1e1e;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    canvas {
      image-rendering: pixelated;
      border: 4px solid #fff;
      background: #87CEEB;
    }
  </style>
</head>
<body>
<canvas id="game" width="640" height="360"></canvas>
<script>
// ============================
// SETUP
// ============================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

const keys = {};
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

// ============================
// PLAYER
// ============================
const player = {
  x: 50, y: 0,
  width: 20, height: 20,
  dx: 0, dy: 0,
  speed: 3,
  jump: -9,
  grounded: false,
  color: "#ff4444",
  lives: 3
};

const gravity = 0.4;
let score = 0;
let gameOver = false;
let gameWin = false;

// ============================
// LEVELS (NO ENEMIES)
// ============================
let currentLevel = 0;
const levels = [
  {
    platforms: [
      {x:0,y:340,w:640,h:20},{x:120,y:280,w:100,h:20},{x:280,y:220,w:100,h:20},{x:440,y:160,w:100,h:20}
    ],
    coins: [
      {x:150,y:250,size:10,collected:false},{x:310,y:190,size:10,collected:false},{x:470,y:130,size:10,collected:false}
    ],
    enemies: [], // no enemies
    goal: {x:580,y:120,w:20,h:40}
  },
  {
  platforms: [
    {x:0,y:340,w:640,h:20},   // ground
    {x:100,y:300,w:80,h:20},  // left platform
    {x:300,y:250,w:160,h:20}, // middle platform (made longer)
    {x:500,y:180,w:100,h:20}  // right platform
  ],
  coins: [
    {x:120,y:270,size:10,collected:false},
    {x:320,y:220,size:10,collected:false},
    {x:520,y:150,size:10,collected:false}
  ],
  enemies: [], // no enemies
  goal: {x:580,y:140,w:20,h:40}
}

  {
    platforms: [
      {x:0,y:340,w:640,h:20},{x:80,y:300,w:80,h:20},{x:200,y:250,w:80,h:20},{x:400,y:200,w:100,h:20}
    ],
    coins: [
      {x:100,y:270,size:10,collected:false},{x:220,y:220,size:10,collected:false},{x:420,y:170,size:10,collected:false}
    ],
    enemies: [], // no enemies
    goal: {x:600,y:160,w:20,h:40}
  }
];

let platforms = [];
let coins = [];
let enemies = [];
let goal = {};

function loadLevel(n){
  const lvl = levels[n];
  platforms = JSON.parse(JSON.stringify(lvl.platforms));
  coins = JSON.parse(JSON.stringify(lvl.coins));
  enemies = []; // always empty
  goal = JSON.parse(JSON.stringify(lvl.goal));
  resetPlayer();
}

// ============================
// SOUND EFFECTS
// ============================
function playBeep(freq, duration=100) {
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.frequency.value = freq;
  osc.type = "square";
  osc.start();
  osc.stop(ctx.currentTime + duration/1000);
}

// ============================
// PLAYER RESET
// ============================
function resetPlayer() {
  player.x = 50; player.y = 0;
  player.dx = 0; player.dy = 0;
  player.grounded = false;
}

// ============================
// UPDATE
// ============================
function update() {
  if(gameOver || gameWin) return;

  // Movement
  player.dx = 0;
  if(keys["ArrowLeft"]) player.dx = -player.speed;
  if(keys["ArrowRight"]) player.dx = player.speed;

  if(keys["Space"] && player.grounded){
    player.dy = player.jump;
    player.grounded = false;
    playBeep(300,150);
  }

  player.dy += gravity;
  player.x += player.dx;
  player.y += player.dy;

  // Platform collisions
  player.grounded = false;
  for(let p of platforms){
    if(player.x < p.x + p.w && player.x + player.width > p.x &&
       player.y < p.y + p.h && player.y + player.height > p.y){
      if(player.dy > 0 && player.y + player.height - player.dy <= p.y){
        player.y = p.y - player.height;
        player.dy = 0;
        player.grounded = true;
      }
    }
  }

  // Coins
  for(let c of coins){
    if(!c.collected && player.x < c.x + c.size && player.x + player.width > c.x &&
       player.y < c.y + c.size && player.y + player.height > c.y){
      c.collected = true;
      score += 10;
      playBeep(600,120);
    }
  }

  // Goal
  if(player.x < goal.x + goal.w && player.x + player.width > goal.x &&
     player.y < goal.y + goal.h && player.y + player.height > goal.y){
    playBeep(800,200); playBeep(1000,200);
    currentLevel++;
    if(currentLevel < levels.length) loadLevel(currentLevel);
    else gameWin = true;
  }

  // Keep inside screen
  if(player.x < 0) player.x = 0;
  if(player.x + player.width > canvas.width) player.x = canvas.width - player.width;
  if(player.y > canvas.height){
    player.lives -= 1;
    playBeep(100,200);
    resetPlayer();
    if(player.lives <= 0) gameOver = true;
  }
}

// ============================
// DRAW
// ============================
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Sky
  ctx.fillStyle = "#87CEEB"; ctx.fillRect(0,0,canvas.width,canvas.height);

  // Mountains
  ctx.fillStyle = "#556B2F";
  ctx.beginPath(); ctx.moveTo(0,340); ctx.lineTo(100,200); ctx.lineTo(200,340); ctx.fill();
  ctx.beginPath(); ctx.moveTo(200,340); ctx.lineTo(350,150); ctx.lineTo(500,340); ctx.fill();
  ctx.beginPath(); ctx.moveTo(400,340); ctx.lineTo(550,220); ctx.lineTo(640,340); ctx.fill();

  // Clouds
  ctx.fillStyle = "#fff";
  [[50,50],[300,80],[500,40]].forEach(cl=>{
    ctx.beginPath();
    ctx.arc(cl[0], cl[1], 15,0,Math.PI*2);
    ctx.arc(cl[0]+20, cl[1]+5, 15,0,Math.PI*2);
    ctx.arc(cl[0]+40, cl[1], 15,0,Math.PI*2);
    ctx.fill();
  });

  // Platforms
  ctx.fillStyle = "#654321";
  for(let p of platforms) ctx.fillRect(p.x,p.y,p.w,p.h);

  // Coins
  ctx.fillStyle = "#FFD700";
  for(let c of coins) if(!c.collected){
    ctx.beginPath();
    ctx.arc(c.x,c.y,c.size/2,0,Math.PI*2);
    ctx.fill();
  }

  // No enemies â€” skipped drawing

  // Goal
  ctx.fillStyle = "#000";
  ctx.fillRect(goal.x,goal.y,4,goal.h);
  ctx.fillStyle = "#FF0000";
  ctx.fillRect(goal.x,goal.y,goal.w,20);

  // Player
  ctx.fillStyle = player.color;
  ctx.fillRect(Math.round(player.x),Math.round(player.y),player.width,player.height);

  // HUD
  ctx.fillStyle = "#000";
  ctx.font = "16px monospace";
  ctx.fillText("Score: "+score,10,20);
  ctx.fillText("Lives: "+player.lives,10,40);

  if(gameOver){
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#fff";
    ctx.font = "24px monospace";
    ctx.fillText("GAME OVER",canvas.width/2-70,canvas.height/2);
  }

  if(gameWin){
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#fff";
    ctx.font = "24px monospace";
    ctx.fillText("YOU WIN!",canvas.width/2-60,canvas.height/2);
    ctx.fillText("Final Score: "+score,canvas.width/2-80,canvas.height/2+30);
  }
}

// ============================
// GAME LOOP
// ============================
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

// ============================
// START GAME
// ============================
loadLevel(currentLevel);
loop();
</script>
</body>
</html>
